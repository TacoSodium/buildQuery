-- 103038198
-- Coryn Tyrrell

-- TOUR (TOUR_NAME, DESCRIPTION)
-- PRIMARY KEY (TOUR_NAME)

-- CLIENT (CLIENT_ID, SURNAME, GIVEN_NAME, GENDER)
-- PRIMARY KEY (CLIENT_ID)

-- EVENT (TOUR_NAME, EVENT_YEAR, EVENT_MONTH, EVENT_DAY, FEE)
-- PRIMARY KEY (TOUR_NAME, EVENT_YEAR, EVENT_MONTH, EVENT_DAY)
-- FOREIGN KEY (TOUR_NAME) REFERENCES TOUR

-- BOOKING (CLIENT_ID, TOUR_NAME, EVENT_YEAR, EVENT_MONTH, EVENT_DAY, DATE_BOOKED, PAYMENT)
-- PRIMARY KEY (CLIENT_ID, TOUR_NAME, EVENT_YEAR, EVENT_MONTH, EVENT_DAY)
-- FOREIGN KEY (CLIENT_ID) REFERENCES CLIENT
-- FOREIGN KEY (TOUR_NAME, EVENT_YEAR, EVENT_MONTH, EVENT_DAY) REFERENCES EVENT


CREATE TABLE TOUR
(
    TOUR_NAME NVARCHAR(100),
    DESCRIPTION NVARCHAR(500),
    PRIMARY KEY (TOUR_NAME)
);

CREATE TABLE CLIENT
(
    CLIENT_ID INT,
    SURNAME NVARCHAR(100) NOT NULL,
    GIVEN_NAME NVARCHAR(100) NOT NULL,
    GENDER NVARCHAR(1),
    CHECK (GENDER = 'M' OR GENDER = 'F' OR GENDER = 'I'),
    PRIMARY KEY (CLIENT_ID)
);

CREATE TABLE EVENT
(
    TOUR_NAME NVARCHAR(100),
    EVENT_YEAR INT,
    CHECK (EVENT_YEAR <= 9999 AND EVENT_YEAR >= 1000),
    EVENT_MONTH NVARCHAR(3),
    CHECK (EVENT_MONTH = 'Jan' OR EVENT_MONTH = 'Feb' OR EVENT_MONTH = 'Mar' OR EVENT_MONTH = 'Apr' OR EVENT_MONTH = 'May' OR EVENT_MONTH = 'Jun' OR EVENT_MONTH = 'Jul' OR EVENT_MONTH = 'Aug' OR EVENT_MONTH = 'Sep' OR EVENT_MONTH = 'Oct' OR EVENT_MONTH = 'Nov' OR EVENT_MONTH = 'Dec'),
    EVENT_DAY INT,
    CHECK (EVENT_DAY >= 1 AND EVENT_DAY <= 31),
    FEE MONEY NOT NULL,
    CHECK (FEE > 0),
    PRIMARY KEY (TOUR_NAME, EVENT_YEAR, EVENT_MONTH, EVENT_DAY),
    FOREIGN KEY (TOUR_NAME) REFERENCES TOUR
);

CREATE TABLE BOOKING
(
    CLIENT_ID INT,
    TOUR_NAME NVARCHAR(100),
    EVENT_YEAR INT,
    CHECK (EVENT_YEAR <= 9999 AND EVENT_YEAR >= 1000),
    EVENT_MONTH NVARCHAR(3),
    CHECK (EVENT_MONTH = 'Jan' OR EVENT_MONTH = 'Feb' OR EVENT_MONTH = 'Mar' OR EVENT_MONTH = 'Apr' OR EVENT_MONTH = 'May' OR EVENT_MONTH = 'Jun' OR EVENT_MONTH = 'Jul' OR EVENT_MONTH = 'Aug' OR EVENT_MONTH = 'Sep' OR EVENT_MONTH = 'Oct' OR EVENT_MONTH = 'Nov' OR EVENT_MONTH = 'Dec'),
    EVENT_DAY INT,
    CHECK (EVENT_DAY >= 1 AND EVENT_DAY <= 31),
    PAYMENT MONEY,
    CHECK (PAYMENT > 0),
    DATE_BOOKED DATE NOT NULL,
    PRIMARY KEY (CLIENT_ID, TOUR_NAME, EVENT_YEAR, EVENT_MONTH, EVENT_DAY),
    FOREIGN KEY (CLIENT_ID) REFERENCES CLIENT,
    FOREIGN KEY (TOUR_NAME, EVENT_YEAR, EVENT_MONTH, EVENT_DAY) REFERENCES EVENT
);
GO


INSERT INTO TOUR
    (TOUR_NAME, DESCRIPTION)
VALUES
    ('North', 'Tour of wineries and outlets of the Bedigo and Castlemaine region'),
    ('South', 'Tour of wineries and outlets of Mornington Penisula'),
    ('West', 'Tour of wineries and outlets of the Geelong and Otways region');

INSERT INTO CLIENT
    (CLIENT_ID, SURNAME, GIVEN_NAME, GENDER)
VALUES
    (1, 'Price', 'Taylor', 'M'),
    (2, 'Gamble', 'Ellyse', 'F'),
    (3, 'Tan', 'Tilly', 'F'),
    (103038198, 'Tyrrell', 'Coryn', 'I');

INSERT INTO EVENT
    (TOUR_NAME, EVENT_YEAR, EVENT_MONTH, EVENT_DAY, FEE)
VALUES
    ('North', 2016, 'Jan', 9, 200),
    ('North', 2016, 'Feb', 13, 225),
    ('South', 2016, 'Jan', 9, 200),
    ('South', 2016, 'Jan', 16, 200),
    ('West', 2016, 'Jan', 29, 225);

INSERT INTO BOOKING
    (CLIENT_ID, TOUR_NAME, EVENT_YEAR, EVENT_MONTH, EVENT_DAY, PAYMENT, DATE_BOOKED)
VALUES
    (1, 'North', 2016, 'Jan', 9, 200, '2015-12-10'),
    (2, 'North', 2016, 'Jan', 9, 200, '2015-12-16'),
    (1, 'North', 2016, 'Feb', 13, 225, '2016-01-08'),
    (2, 'North', 2016, 'Feb', 13, 125, '2016-01-14'),
    (3, 'North', 2016, 'Feb', 13, 225, '2016-02-03'),
    (1, 'South', 2016, 'Jan', 9, 200, '2015-12-10'),
    (2, 'South', 2016, 'Jan', 16, 200, '2015-12-18'),
    (3, 'South', 2016, 'Jan', 16, 200, '2016-01-09'),
    (2, 'West', 2016, 'Jan', 29, 225, '2015-12-17'),
    (3, 'West', 2016, 'Jan', 29, 200, '2015-12-18');
GO